// MODIFIED version of https://github.com/biril/mp3-parser
// Licensed and freely distributed under the MIT License
// Copyright (c) 2013-2016 Alex Lambiris
!function(e,r){"use strict";if("function"==typeof define&&define.amd)return define(["exports"],r);if("object"==typeof exports)return r(exports);var t=e.mp3ParserLib;r(e.mp3ParserLib={noConflict:function(){var r=e.mp3ParserLib;return e.mp3ParserLib=t,(this.noConflict=function(){return r}).call()}})}(this,(function(e){"use strict";var r,t=(r=[],function(e){return r[0]=128==(128&e)?"1":"0",r[1]=64==(64&e)?"1":"0",r[2]=32==(32&e)?"1":"0",r[3]=16==(16&e)?"1":"0",r[4]=8==(8&e)?"1":"0",r[5]=4==(4&e)?"1":"0",r[6]=2==(2&e)?"1":"0",r[7]=1==(1&e)?"1":"0",r.join("")});e.getFrameByteLength=function(r,t,n,i,a){var s=e.sampleLengthMap[i][a],o=n?"11"===a?4:1:0,l=1e3*r/8;return Math.floor(s*l/t+o)},e.getXingOffset=function(e,r){var t="11"===r;return"11"===e?t?21:36:t?13:21},e.v1l1Bitrates={"0000":"free","0001":32,"0010":64,"0011":96,"0100":128,"0101":160,"0110":192,"0111":224,1e3:256,1001:288,1010:320,1011:352,1100:384,1101:416,1110:448,1111:"bad"},e.v1l2Bitrates={"0000":"free","0001":32,"0010":48,"0011":56,"0100":64,"0101":80,"0110":96,"0111":112,1e3:128,1001:160,1010:192,1011:224,1100:256,1101:320,1110:384,1111:"bad"},e.v1l3Bitrates={"0000":"free","0001":32,"0010":40,"0011":48,"0100":56,"0101":64,"0110":80,"0111":96,1e3:112,1001:128,1010:160,1011:192,1100:224,1101:256,1110:320,1111:"bad"},e.v2l1Bitrates={"0000":"free","0001":32,"0010":48,"0011":56,"0100":64,"0101":80,"0110":96,"0111":112,1e3:128,1001:144,1010:160,1011:176,1100:192,1101:224,1110:256,1111:"bad"},e.v2l2Bitrates={"0000":"free","0001":8,"0010":16,"0011":24,"0100":32,"0101":40,"0110":48,"0111":56,1e3:64,1001:80,1010:96,1011:112,1100:128,1101:144,1110:160,1111:"bad"},e.v2l3Bitrates=e.v2l2Bitrates,e.v1SamplingRates={"00":44100,"01":48e3,10:32e3,11:"reserved"},e.v2SamplingRates={"00":22050,"01":24e3,10:16e3,11:"reserved"},e.v25SamplingRates={"00":11025,"01":12e3,10:8e3,11:"reserved"},e.channelModes={"00":"Stereo","01":"Joint stereo (Stereo)",10:"Dual channel (Stereo)",11:"Single channel (Mono)"},e.mpegVersionDescription={"00":"MPEG Version 2.5 (unofficial)","01":"reserved",10:"MPEG Version 2 (ISO/IEC 13818-3)",11:"MPEG Version 1 (ISO/IEC 11172-3)"},e.layerDescription={"00":"reserved","01":"Layer III",10:"Layer II",11:"Layer I"},e.bitrateMap={11:{"01":e.v1l3Bitrates,10:e.v1l2Bitrates,11:e.v1l1Bitrates},10:{"01":e.v2l3Bitrates,10:e.v2l2Bitrates,11:e.v2l1Bitrates}},e.samplingRateMap={"00":e.v25SamplingRates,10:e.v2SamplingRates,11:e.v1SamplingRates},e.v1SampleLengths={"01":1152,10:1152,11:384},e.v2SampleLengths={"01":576,10:1152,11:384},e.sampleLengthMap={"01":e.v2SampleLengths,10:e.v2SampleLengths,11:e.v1SampleLengths},e.wordSeqFromStr=function(e){for(var r=e.length-1,t=[];r>=0;--r)t[r]=e.charCodeAt(r);return t},e.seq={id3:e.wordSeqFromStr("ID3"),xing:e.wordSeqFromStr("Xing"),info:e.wordSeqFromStr("Info")},e.noOp=function(){},e.unsynchsafe=function(e){for(var r=0,t=2130706432;t;)r>>=1,r|=e&t,t>>=8;return r},e.isSeq=function(e,r,t){for(var n=e.length-1;n>=0;n--)if(e[n]!==r.getUint8(t+n))return!1;return!0},e.locateSeq=function(r,t,n,i){for(var a=0,s=i-r.length+1;a<s;++a)if(e.isSeq(r,t,n+a))return n+a;return-1},e.locateStrTrm={iso:function(r,t,n){return e.locateSeq([0],r,t,n)},ucs:function(r,t,n){var i=e.locateSeq([0,0],r,t,n);return-1===i?-1:((i-t)%2!=0&&++i,i)}},e.readStr={iso:function(e,r,t){return String.fromCharCode.apply(null,new Uint8Array(e.buffer,r,t))},ucs:function(e,r,t){65534!==e.getUint16(r)&&65279!==e.getUint16(r)||(r+=2,t-=2);var n=e.buffer;return r%2==1&&(n=n.slice(r,r+t),r=0),String.fromCharCode.apply(null,new Uint16Array(n,r,t/2))}},e.readTrmStr={iso:function(r,t,n){var i=e.locateStrTrm.iso(r,t,n);return-1!==i&&(n=i-t),e.readStr.iso(r,t,n)},ucs:function(r,t,n){var i=e.locateStrTrm.ucs(r,t,n);return-1!==i&&(n=i-t),e.readStr.ucs(r,t,n)}},e.readFrameHeader=function(r,n){if(n||(n=0),r.byteLength-n<=4)return null;if(255!==r.getUint8(n))return null;var i=r.getUint8(n+1);if(i<224)return null;var a=t(i).substr(3,2),s=t(i).substr(5,2),o={_section:{type:"frameHeader",byteLength:4,offset:n},mpegAudioVersionBits:a,mpegAudioVersion:e.mpegVersionDescription[a],layerDescriptionBits:s,layerDescription:e.layerDescription[s],isProtected:1&i};if(o.protectionBit=o.isProtected?"1":"0","reserved"===o.mpegAudioVersion)return null;if("reserved"===o.layerDescription)return null;var l=r.getUint8(n+2);if(l=t(l),o.bitrateBits=l.substr(0,4),o.bitrate=e.bitrateMap[a][s][o.bitrateBits],"bad"===o.bitrate)return null;if(o.samplingRateBits=l.substr(4,2),o.samplingRate=e.samplingRateMap[a][o.samplingRateBits],"reserved"===o.samplingRate)return null;o.frameIsPaddedBit=l.substr(6,1),o.frameIsPadded="1"===o.frameIsPaddedBit,o.framePadding=o.frameIsPadded?1:0,o.privateBit=l.substr(7,1);var u=r.getUint8(n+3);return o.channelModeBits=t(u).substr(0,2),o.channelMode=e.channelModes[o.channelModeBits],o},e.readFrame=function(r,t,n){t||(t=0);var i={_section:{type:"frame",offset:t},header:e.readFrameHeader(r,t)},a=i.header;if(!a)return null;i._section.sampleLength=e.sampleLengthMap[a.mpegAudioVersionBits][a.layerDescriptionBits],i._section.byteLength=e.getFrameByteLength(a.bitrate,a.samplingRate,a.framePadding,a.mpegAudioVersionBits,a.layerDescriptionBits),i._section.nextFrameIndex=t+i._section.byteLength;var s=e.getXingOffset(a.mpegAudioVersionBits,a.channelModeBits);return e.isSeq(e.seq.xing,r,t+s)||e.isSeq(e.seq.info,r,t+s)?null:n&&!e.readFrameHeader(r,i._section.nextFrameIndex)?null:i}}));
!function(e,n){"use strict";if("function"==typeof define&&define.amd)return define(["exports","./lib"],n);if("object"==typeof exports)return n(exports,require("./lib"));var i=e.mp3XingParser;n(e.mp3XingParser={noConflict:function(){var n=e.mp3XingParser;return e.mp3XingParser=i,(this.noConflict=function(){return n}).call()}},e.mp3ParserLib)}(this,(function(e,n){"use strict";e.readXingTag=function(e,i){i||(i=0);var r={_section:{type:"Xing",offset:i},header:n.readFrameHeader(e,i),vbrinfo:{}},t=r.header;if(!t)return null;var f=i+n.getXingOffset(t.mpegAudioVersionBits,t.channelModeBits);if(e.byteLength<f+4)return null;if(r.identifier=n.isSeq(n.seq.xing,e,f)?"Xing":n.isSeq(n.seq.info,e,f)&&"Info",!r.identifier)return null;let o=4,a=e.getUint32(f+o);if(o+=4,1&a&&(r.vbrinfo.frames_raw=e.getUint32(f+o),o+=4),2&a&&(r.vbrinfo.bytes_raw=e.getUint32(f+o),o+=4),4&a){r.vbrinfo.toc_raw=new Array(100);for(let n=0;n<100;++n)r.vbrinfo.toc_raw[n]=e.getUint8(f+o+n);o+=100}8&a&&(r.vbrinfo.vbr_scale_raw=e.getUint32(f+o),o+=4);let s=new Uint8Array(e.buffer,e.byteOffset+f+o,9);r.vbrinfo.lame_version=String.fromCharCode.apply(null,s),o+=21;let g=e.getUint8(f+o),b=e.getUint8(f+o+1),l=e.getUint8(f+o+2);return r.vbrinfo.ENC_DELAY=g<<4|b>>4,r.vbrinfo.ENC_PADDING=(15&b)<<8|l,(r.vbrinfo.ENC_DELAY<0||r.vbrinfo.ENC_DELAY>3e3)&&(r.vbrinfo.ENC_DELAY=-1),(r.vbrinfo.ENC_PADDING<0||r.vbrinfo.ENC_PADDING>3e3)&&(r.vbrinfo.ENC_PADDING=-1),r._section.byteLength=n.getFrameByteLength(t.bitrate,t.samplingRate,t.framePadding,t.mpegAudioVersionBits,t.layerDescriptionBits),r._section.nextFrameIndex=i+r._section.byteLength,r}}));
!function(e,r){"use strict";if("function"==typeof define&&define.amd)return define(["exports","./lib"],r);if("object"==typeof exports)return r(exports,require("./lib"));var t=e.mp3Id3v2Parser;r(e.mp3Id3v2Parser={noConflict:function(){var r=e.mp3Id3v2Parser;return e.mp3Id3v2Parser=t,(this.noConflict=function(){return r}).call()}},e.mp3ParserLib)}(this,(function(e,r){"use strict";var t={AENC:"Audio encryption",APIC:"Attached picture",CHAP:"Chapter",COMM:"Comments",COMR:"Commercial frame",ENCR:"Encryption method registration",EQUA:"Equalization",ETCO:"Event timing codes",GEOB:"General encapsulated object",GRID:"Group identification registration",IPLS:"Involved people list",LINK:"Linked information",MCDI:"Music CD identifier",MLLT:"MPEG location lookup table",OWNE:"Ownership frame",PRIV:"Private frame",PCNT:"Play counter",POPM:"Popularimeter",POSS:"Position synchronisation frame",RBUF:"Recommended buffer size",RVAD:"Relative volume adjustment",RVRB:"Reverb",SYLT:"Synchronized lyric/text",SYTC:"Synchronized tempo codes",TALB:"Album/Movie/Show title",TBPM:"BPM (beats per minute)",TCOM:"Composer",TCON:"Content type",TCOP:"Copyright message",TDAT:"Date",TDLY:"Playlist delay",TENC:"Encoded by",TEXT:"Lyricist/Text writer",TFLT:"File type",TIME:"Time",TIT1:"Content group description",TIT2:"Title/songname/content description",TIT3:"Subtitle/Description refinement",TKEY:"Initial key",TLAN:"Language(s)",TLEN:"Length",TMED:"Media type",TOAL:"Original album/movie/show title",TOFN:"Original filename",TOLY:"Original lyricist(s)/text writer(s)",TOPE:"Original artist(s)/performer(s)",TORY:"Original release year",TOWN:"File owner/licensee",TPE1:"Lead performer(s)/Soloist(s)",TPE2:"Band/orchestra/accompaniment",TPE3:"Conductor/performer refinement",TPE4:"Interpreted, remixed, or otherwise modified by",TPOS:"Part of a set",TPUB:"Publisher",TRCK:"Track number/Position in set",TRDA:"Recording dates",TRSN:"Internet radio station name",TRSO:"Internet radio station owner",TSIZ:"Size",TSRC:"ISRC (international standard recording code)",TSSE:"Software/Hardware and settings used for encoding",TYER:"Year",TXXX:"User defined text information frame",UFID:"Unique file identifier",USER:"Terms of use",USLT:"Unsychronized lyric/text transcription",WCOM:"Commercial information",WCOP:"Copyright/Legal information",WOAF:"Official audio file webpage",WOAR:"Official artist/performer webpage",WOAS:"Official audio source webpage",WORS:"Official internet radio station homepage",WPAY:"Payment",WPUB:"Publishers official webpage",WXXX:"User defined URL link frame"},i={T:function(e,t,i){var n={encoding:e.getUint8(t)};return n.value=r.readStr[0===n.encoding?"iso":"ucs"](e,t+1,i-1),n},TXXX:function(e,t,i){var n={encoding:e.getUint8(t)};if(i<2)return n;var a=0===n.encoding?"iso":"ucs",o=t+1,s=r.locateStrTrm[a](e,o,i-4);return-1===s?n:(n.description=r.readStr[a](e,o,s-o),s+="ucs"===a?2:1,n.value=r.readStr[a](e,s,t+i-s),n)},W:function(e,t,i){return{value:r.readStr.iso(e,t,i)}},WXXX:function(e,t,i){var n={encoding:e.getUint8(t)};if(i<2)return n;var a=0===n.encoding?"iso":"ucs",o=t+1,s=r.locateStrTrm[a](e,o,i-4);return-1===s?n:(n.description=r.readStr[a](e,o,s-o),s+="ucs"===a?2:1,n.value=r.readStr.iso(e,s,t+i-s),n)},COMM:function(e,t,i){var n={encoding:e.getUint8(t)};if(i<5)return n;var a=0===n.encoding?"iso":"ucs",o=t+4;n.language=r.readTrmStr.iso(e,t+1,3);var s=r.locateStrTrm[a](e,o,i-4);return-1===s?n:(n.description=r.readStr[a](e,o,s-o),s+="ucs"===a?2:1,n.text=r.readStr[a](e,s,t+i-s),n)},UFID:function(e,t,i){var n=r.readTrmStr.iso(e,t,i);return{ownerIdentifier:n,identifier:new DataView(e.buffer,t+n.length+1,i-n.length-1)}},IPLS:function(e,t,i){for(var n,a={encoding:e.getUint8(t),values:[]},o=0===a.encoding?"iso":"ucs",s=t+1;s<t+i;)-1===(n=r.locateStrTrm[o](e,s,i-(s-t)))&&(n=t+i),a.values.push(r.readStr[o](e,s,n-s)),s=n+("ucs"===o?2:1);return a},USER:function(e,t,i){var n={encoding:e.getUint8(t)};if(i<5)return n;n.language=r.readTrmStr.iso(e,t+1,3);var a=t+4,o=0===n.encoding?"iso":"ucs";return n.text=r.readStr[o](e,a,t+i-a),n},PRIV:function(e,t,i){var n=r.readTrmStr.iso(e,t,i);return{ownerIdentifier:n,privateData:new DataView(e.buffer,t+n.length+1,i-n.length-1)}},PCNT:function(e,r,t){return t<4?{}:{counter:e.getUint32(r)}},POPM:function(e,t,i){var n={email:r.readTrmStr.iso(e,t,i)};return t+=n.email.length+1,i<6?n:(n.rating=e.getUint8(t),n.counter=e.getUint32(t+1),n)},APIC:function(e,t,i){var n={encoding:e.getUint8(t)};if(i<4)return n;var a,o,s=0===n.encoding?"iso":"ucs";return a=t+1,-1===(o=r.locateStrTrm.iso(e,a,i-1))?n:(n.mimeType=r.readStr.iso(e,a,o-a),a=o+1,n.pictureType=e.getUint8(a),a+=1,-1===(o=r.locateStrTrm[s](e,a,t+i-a))?n:(n.description=r.readStr[s](e,a,o-a),a=o+("ucs"===s?2:1),n.pictureData=new DataView(e.buffer,a,t+i-a),n))},CHAP:function(t,i,n){var a={encoding:t.getUint8(i)},o=r.locateStrTrm.iso(t,i,n-1);if(-1===o)return a;a.id=r.readStr.iso(t,i,o-i),a.startTime=t.getUint32(o+1),a.endTime=t.getUint32(o+5),a.startOffset=t.getUint32(o+9),a.endOffset=t.getUint32(o+13);var s=o+17;for(a.frames=[];s<i+n;){var d=e.readId3v2TagFrame(t,s);a.frames.push(d),s+=d.header.size+10}return a}};e.readId3v2TagFrame=function(e,n){var a={header:{id:r.readStr.iso(e,n,4),size:e.getUint32(n+4),flagsOctet1:e.getUint8(n+8),flagsOctet2:e.getUint8(n+9)}};if(a.header.size<1)return a;var o,s,d=(o=i,"TXXX"===(s=a.header.id)?o.TXXX:"T"===s.charAt(0)?o.T:"WXXX"===s?o.WXXX:"W"===s.charAt(0)?o.W:"COMM"===s||"USLT"===s?o.COMM:o[s]||r.noOp);return a.name=t[a.header.id],a.content=d(e,n+10,a.header.size),a},e.readId3v2Tag=function(t,i){if(i||(i=0),t.byteLength-i<10)return null;if(!r.isSeq(r.seq.id3,t,i))return null;var n=t.getUint8(i+5),a={_section:{type:"ID3v2",offset:i},header:{majorVersion:t.getUint8(i+3),minorRevision:t.getUint8(i+4),flagsOctet:n,unsynchronisationFlag:128==(128&n),extendedHeaderFlag:64==(64&n),experimentalIndicatorFlag:32==(32&n),size:r.unsynchsafe(t.getUint32(i+6))},frames:[]};a._section.byteLength=a.header.size+10;var o,s=i+a._section.byteLength;if(3!==a.header.majorVersion)return a;for(i+=10;i<s&&0!==t.getUint32(i)&&(o=e.readId3v2TagFrame(t,i));)a.frames.push(o),i+=o.header.size+10;return a}}));
!function(r,e){"use strict";if("function"==typeof define&&define.amd)return define(["exports","./lib/lib","./lib/id3v2","./lib/xing"],e);if("object"==typeof exports)return e(exports,require("./lib/lib"),require("./lib/id3v2"),require("./lib/xing"));var n=r.mp3Parser;e(r.mp3Parser={noConflict:function(){var e=r.mp3Parser;return r.mp3Parser=n,(this.noConflict=function(){return e}).call()}},r.mp3ParserLib,r.mp3Id3v2Parser,r.mp3XingParser)}(this,(function(r,e,n,t){"use strict";r.readFrameHeader=function(r,n){return e.readFrameHeader(r,n)},r.readFrame=function(r,n,t){return e.readFrame(r,n,t)},r.readLastFrame=function(e,n,t){n||(n=e.byteLength-1);for(var i=null;n>=0;--n)if(255===e.getUint8(n)&&(i=r.readFrame(e,n,t)))return i;return null},r.readId3v2Tag=function(r,e){return n.readId3v2Tag(r,e)},r.readXingTag=function(r,e){return t.readXingTag(r,e)},r.readTags=function(e,n){n||(n=0);for(var t=[],i=null,a=!1,u=e.byteLength,f=[r.readId3v2Tag,r.readXingTag,r.readFrame],d=f.length;n<u&&!a;++n)for(var o=0;o<d;++o)if(i=f[o](e,n)){if(t.push(i),n+=i._section.byteLength,"frame"===i._section.type){a=!0;break}o=-1}return t}}));
